(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{132:function(e,t,a){},156:function(e,t,a){e.exports=a(477)},157:function(e,t,a){},225:function(e,t,a){},227:function(e,t,a){},453:function(e,t,a){},455:function(e,t,a){},457:function(e,t,a){},459:function(e,t,a){},475:function(e,t,a){},477:function(e,t,a){"use strict";a.r(t);a(157);var r=a(0),n=a.n(r),i=a(3),o=a.n(i),s=a(9),c=a(12),l=a(13),u=a(16),m=a(15),d=a(17),f=a(81),h=a(42),p=a.n(h),g=a(485),v=a(486),y=a(76),E=a(7),b=a.n(E),w=a(18),x=a(105),A=a(83),R=a(48),T=a(138),O=a(10),S="SAVE_ARTICLE_LIST",L={articles:void 0,count:0},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S:return Object(O.a)({},e,{articles:t.payload.articles,count:t.payload.count});default:return e}},P="SAVE_CATEGORY_LIST",_={categories:void 0},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return Object(O.a)({},e,{categories:t.payload.categories});default:return e}};function B(){return window.innerWidth<1240||!!/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}var D,N="SET_IS_MOBILE",k={isMobile:B()},z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case N:return Object(O.a)({},e,{isMobile:t.payload.isMobile});default:return e}},I="SET_LOADING",j={loading:!1},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case I:return Object(O.a)({},e,{loading:t.payload.loading});default:return e}},U="LOGOUT_READER",H="SAVE_READER",G="SAVE_PUBLISHER",Y={reader:void 0,publisher:void 0},W=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case U:return p.a.remove("jwt"),Object(O.a)({},e,{reader:void 0});case H:return Object(O.a)({},e,{reader:t.payload.reader});case G:return Object(O.a)({},e,{publisher:t.payload.publisher});default:return e}},X=Object(A.a)(),q=(D=X,Object(R.combineReducers)({articleList:C,categoryList:F,isMobile:z,loading:M,user:W,router:Object(f.b)(D)})),V=function(){var e=[Object(x.a)(X)],t=R.applyMiddleware.apply(void 0,e);return Object(R.createStore)(q,Object(T.composeWithDevTools)(t))}(),Z=function(){return{type:U}},K=function(e){return{type:H,payload:{reader:e}}},$=function(e){return{type:G,payload:{publisher:e}}},J=a(479),Q=a(140),ee=function(e){return{type:I,payload:{loading:e}}},te="https://bloggy-service.herokuapp.com",ae={200:"The request has succeeded and the server has returned requested data.",201:"The request has succeeded and a resource has been created or modified as a result.",202:"The request has been received but not yet acted upon.",204:"Deletion has succeeded",400:"The server could not understand the request due to invalid syntax.",401:"The client must authenticate itself to get the requested response.",403:"The client does not have access rights to the content.",404:"The server can not find the requested resource.",406:"The server cannot find any content that conforms to the criteria given by the user agent.",410:"The content has been permanently deleted from the server, with no forwarding address.",422:"The request was well-formed but was unable to be followed due to semantic errors.",500:"The server has encountered a situation it does not know how to handle.",502:"Bad gateway",503:"Service unavailable: The server is down for maintenance or is overloaded.",504:"Gateway timeout"},re=Object(Q.a)({errorHandler:function(e){var t=e.response,a=e.data;if(t&&t.status){var r=a||ae[t.status],n=t.status,i=t.url;J.a.error({message:"Request error: ".concat(n,": ").concat(i),description:r})}else t||(J.a.error({description:"Your Internet has a problem. Cannot connect to the server",message:"Network error"}),V.dispatch(ee(!1)));return t},credentials:"include",getResponse:!0});re.use(function(){var e=Object(w.a)(b.a.mark(function e(t,a){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.req.url!=="".concat(te,"/login")&&t.req.url!=="".concat(te,"/register")&&t.req.url!=="".concat(te,"/getArticle")&&t.req.url!=="".concat(te,"/getCommentList")&&t.req.url!=="".concat(te,"/likeArticle")){e.next=5;break}return e.next=3,a();case 3:e.next=9;break;case 5:return V.dispatch(ee(!0)),e.next=8,a();case 8:V.dispatch(ee(!1));case 9:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}());var ne=re,ie="https://bloggy-service.herokuapp.com",oe=function(e){return ne("".concat(ie,"/getUser"),{method:"POST",data:e})},se=function(e){return ne("".concat(ie,"/login"),{method:"POST",data:e})},ce=function(e){return ne("".concat(ie,"/register"),{method:"POST",data:e})},le=function(){return ne("".concat(ie,"/getCurrentUser"),{method:"GET"})},ue=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(n)))).fetchCurrentUser=Object(w.a)(b.a.mark(function e(){var t,a;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("string"===typeof p.a.get("jwt")&&p.a.get("jwt").length>0)){e.next=6;break}return e.next=4,le();case 4:(t=e.sent).data?(a=t.data,V.dispatch(K(a.user))):p.a.remove("jwt");case 6:case"end":return e.stop()}},e)})),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){this.fetchCurrentUser()}},{key:"render",value:function(){return this.props.children}}]),t}(r.Component),me=a(480),de=Object(s.c)(function(e){return{loading:e.loading.loading}})(function(e){if(!1===e.loading)return e.children;return n.a.createElement("div",{style:{color:"#999",textAlign:"center",padding:50,fontSize:16}},n.a.createElement(me.a,{size:"large"}))}),fe=function(e){return{type:N,payload:{isMobile:e}}},he=(a(225),a(227),a(481)),pe=a(27),ge=a(103),ve=a(59),ye={PUBLISHER:"publisher",PUBLISHER_ID:"publisherId",PAGE:"page"},Ee="home",be="articleList",we="articleDetail",xe="about",Ae={ARTICLE_ID:"articleId",CATEGORY_ID:"categoryId"},Re="https://bloggy-service.herokuapp.com",Te=function(e){return ne("".concat(Re,"/getArticleList"),{method:"POST",data:e})},Oe=function(e){return ne("".concat(Re,"/getArticle"),{method:"POST",data:e})},Se=function(e){return ne("".concat(Re,"/likeArticle"),{method:"POST",data:e})},Le=function(e){return ne("".concat("https://bloggy-service.herokuapp.com","/createComment"),{method:"POST",data:e})},Ce=function(e){return ne("".concat("https://bloggy-service.herokuapp.com","/getCommentList"),{method:"POST",data:e})};function Pe(e,t){var a=new Date(e),r=a.getFullYear()+"-",n=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-",i=a.getDate()<10?"0"+a.getDate()+" ":a.getDate()+" ",o=a.getHours()<10?"0"+a.getHours()+":":a.getHours()+":",s=a.getMinutes()<10?"0"+a.getMinutes()+":":a.getMinutes()+":",c=a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds();return t?r+n+i+o+s+c:r+n+i}var _e=a(113),Fe=a.n(_e),Be=a(86),De=a.n(Be),Ne={add:function(e,t){var a="#toc".concat(t).concat(++this.index);return this.toc.push({anchor:a,level:t,text:e}),a},toHTML:function(){var e=[],t="",a=function(){t+="</ul>\n"},r=function(e,a){t+='<li><a class="toc-link" href="#'+e+'">'+a+"<a></li>\n"};for(this.toc.forEach(function(n){var i=e.indexOf(n.level);if(-1===i)e.unshift(n.level),t+='<ul class="anchor-ul" id="anchor-fix">',r(n.anchor,n.text);else if(0===i)r(n.anchor,n.text);else{for(;i--;)e.shift(),a();r(n.anchor,n.text)}});e.length;)e.shift(),a();return this.toc=[],this.index=0,t},toc:[],index:0},ke=new(function(){function e(){Object(c.a)(this,e),this.rendererMD=new De.a.Renderer,this.rendererMD.heading=function(e,t,a){var r=Ne.add(e,t);return"<h".concat(t," id=").concat(r,">").concat(e,"</h").concat(t,">\n")},this.rendererMD.table=function(e,t){return'<table class="table" border="0" cellspacing="0" cellpadding="0">'+e+t+"</table>"},Fe.a.configure({useBR:!0}),De.a.setOptions({renderer:this.rendererMD,headerIds:!1,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,highlight:function(e){return Fe.a.highlightAuto(e).value}})}return Object(l.a)(e,[{key:"marked",value:function(){var e=Object(w.a)(b.a.mark(function e(t){var a,r;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return e.next=3,De()(t);case 3:return a=e.sent,r=Ne.toHTML(),e.abrupt("return",{content:a,toc:r});case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}());function ze(e){var t=window.location.search.match(new RegExp("[?&]"+e+"=([^&]+)","i"));return null===t||t.length<1?null:t[1]}var Ie=function(){return n.a.createElement("div",{style:{color:"#999",textAlign:"center",padding:50,fontSize:16}},n.a.createElement(me.a,{size:"large"}))},je=(a(132),a(75)),Me=a.n(je),Ue=function(e){var t=e.comments.map(function(e){return n.a.createElement(Me.a,{key:e._id,transitionName:"example",transitionAppear:!0,transitionAppearTimeout:1e3,transitionEnterTimeout:1e3,transitionLeaveTimeout:1e3},n.a.createElement("div",{className:"item"},n.a.createElement("div",{className:"item-header"},n.a.createElement("div",{className:"author"},n.a.createElement("div",{className:"avator"},n.a.createElement(he.a,{size:"large",icon:"user",src:e.user.avatar}))),n.a.createElement("div",{className:"info"},n.a.createElement("div",{className:"name"},e.user.name),n.a.createElement("div",{className:"time"},e.createdOn?Pe(e.createdOn,!0):""))),n.a.createElement("div",{className:"comment-detail"},e.content)))});return n.a.createElement("div",{className:"comment-list"},n.a.createElement("div",{className:"top-title"},n.a.createElement("span",null,e.comments.length," comments")),t)},He=a(488),Ge=He.a.TextArea,Ye=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(n)))).state={content:""},a.handleChange=function(e){a.setState(Object(O.a)({},a.state,{content:e.target.value}))},a.handleSubmit=function(e){a.submitComment()},a.submitComment=Object(w.a)(b.a.mark(function e(){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return""===a.state.content&&J.a.error({message:"Comment cannot be empty."}),a.props.reader||J.a.error({message:"Please log in first."}),e.next=4,Le({articleId:a.props.articleId,content:a.state.content});case 4:e.sent.data&&J.a.success({message:"Comment posted."});case 6:case"end":return e.stop()}},e)})),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.reader;return n.a.createElement("div",{className:"comment"},n.a.createElement("div",{className:"avatar"},e?n.a.createElement(he.a,{className:"auth-logo",size:50,src:e.avatar}):n.a.createElement(he.a,{className:"auth-logo",size:50,icon:"user"})),n.a.createElement("h3",null,e?e.name:""),n.a.createElement(Ge,{className:"textarea",name:"content",value:this.state.content,onChange:this.handleChange,placeholder:"Pease be considerate and polite in your comment.",rows:4}),n.a.createElement("div",{className:"new-comment write-function-block"},n.a.createElement("div",{onClick:this.handleSubmit,className:"btn btn-send"},"Submit")))}}]),t}(r.Component),We=Object(s.c)(function(e){return{reader:e.user.reader}})(Ye),Xe=function(e){function t(e){var a;Object(c.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).fetchArticle=Object(w.a)(b.a.mark(function e(){var t,r,n,i;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe({_id:a.state.articleId,isVisitor:!0});case 2:if(!(t=e.sent).data){e.next=12;break}return r=t.data,n=Object(O.a)({},r.article,{toc:""}),e.next=8,ke.marked(n.content);case 8:i=e.sent,n.content=i?i.content:"",n.toc=i?i.toc:"",a.setState(Object(O.a)({},a.state,{article:n,loadingArticle:!1}));case 12:case"end":return e.stop()}},e)})),a.fetchComments=Object(w.a)(b.a.mark(function e(){var t,r;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce({articleId:a.state.articleId});case 2:(t=e.sent).data&&(r=t.data,a.setState(Object(O.a)({},a.state,{comments:r.commentList,loadingComments:!1})));case 4:case"end":return e.stop()}},e)})),a.handleLike=function(){a.submitLike()},a.submitLike=Object(w.a)(b.a.mark(function e(){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState(Object(O.a)({},a.state,{likeLoading:!0})),e.next=3,Se({_id:a.state.articleId});case 3:e.sent.data&&J.a.success({message:"Liked!"}),a.setState(Object(O.a)({},a.state,{likeLoading:!1}));case 6:case"end":return e.stop()}},e)}));var r="";if(a.props.isAboutPage){var n=a.props.articleList.filter(function(e){return e.isAboutPage});0===n.length?(J.a.warn({message:"About page is under construction."}),a.props.history.push("/".concat(ye.PUBLISHER,"/").concat(a.props.publisher._id))):r=n[0]._id}else r=ze(Ae.ARTICLE_ID);return a.state={articleId:r,article:void 0,comments:void 0,loadingComments:!0,loadingArticle:!0,likeLoading:!1},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){""!==this.state.articleId&&(this.fetchArticle(),this.fetchComments())}},{key:"render",value:function(){if(this.state.loadingArticle||this.state.loadingComments)return n.a.createElement(n.a.Fragment,null,n.a.createElement(ve.a,null,n.a.createElement("title",null,"Bloggy Reader")),n.a.createElement(Ie,null));var e=this.props.isMobile?"100%":"75%",t=this.state.article,a=this.state.comments,r=t.categories.map(function(e){return n.a.createElement("span",{key:e._id,className:"tag"},e.name)});return n.a.createElement(n.a.Fragment,null,n.a.createElement(ve.a,null,n.a.createElement("title",null,t.title)),n.a.createElement("div",{className:"article clearfix"},n.a.createElement("div",{className:"detail fl",style:{width:e}},n.a.createElement("div",{className:"header"},n.a.createElement("div",{className:"title"},t.title),n.a.createElement("div",{className:"author"},n.a.createElement("div",{className:"avatar"},n.a.createElement(he.a,{className:"auth-logo",src:t.author.avatar,size:50,icon:"user"}))," ",n.a.createElement("div",{className:"info"},n.a.createElement("span",{className:"name"},n.a.createElement("span",null,t.author.name)),n.a.createElement("div",{"props-data-classes":"user-follow-button-header","data-author-follow-button":""}),n.a.createElement("div",{className:"meta"},n.a.createElement("span",{className:"publish-time"},t.createdOn?Pe(t.createdOn,!0):""),n.a.createElement("span",{className:"wordage"}," ",t.wordCount," Words"," "),n.a.createElement("span",{className:"views-count"}," ",n.a.createElement(pe.a,{type:"eye",theme:"outlined"})," ",t.meta?t.meta.numViews:"-"," "),n.a.createElement("span",{className:"comments-count"}," ",n.a.createElement(pe.a,{type:"message",theme:"outlined"})," ",t.meta?t.meta.numComments:"-"," "),n.a.createElement("span",{className:"likes-count"}," ",n.a.createElement(pe.a,{type:"heart",theme:"outlined"})," ",t.meta?t.meta.numLikes:"-"," "))),n.a.createElement("div",{className:"tags ",title:"Categories"},n.a.createElement(pe.a,{type:"tags",theme:"outlined"}),r),n.a.createElement("span",{className:"clearfix"}))),n.a.createElement("div",{className:"content"},n.a.createElement("div",{id:"content",className:"article-detail",dangerouslySetInnerHTML:{__html:t.content?t.content:""}})),n.a.createElement("div",{className:"heart"},n.a.createElement(ge.a,{type:"danger",size:"large",icon:"heart",loading:this.state.likeLoading,onClick:this.handleLike},"Like")),n.a.createElement(We,{articleId:t._id}),n.a.createElement(Ue,{comments:a})),this.props.isMobile?"":n.a.createElement("div",{style:{width:"23%"},className:"article-right fr anchor",dangerouslySetInnerHTML:{__html:t.toc?t.toc:""}})))}}]),t}(r.Component),qe=Object(s.c)(function(e){return{publisher:e.user.publisher,reader:e.user.reader,isMobile:e.isMobile.isMobile,articleList:e.articleList.articles}})(Xe),Ve=(a(453),a(482)),Ze=function(e){var t=e.articles,a=e.count;return{type:S,payload:{articles:t,count:a}}},Ke=function(e){return n.a.createElement("div",{style:{color:"#999",textAlign:"center",padding:50,fontSize:16}}," --------- I have a bottom line :) --------- ")},$e=Object(y.a)(1e3,function(){for(var e=window.innerHeight||document.documentElement.clientHeight,t=document.querySelectorAll("#list .wrap-img img"),a=0,r=a;r<t.length;r++){if(e-t[r].getBoundingClientRect().top>=100)"false"===t[r].getAttribute("data-has-lazy-src")&&(t[r].src=t[r].getAttribute("data-src"),t[r].setAttribute("data-has-lazy-src",!0)),a=r+1}}),Je={saveArticleList:Ze},Qe=function(e){return n.a.createElement(Ve.a,{className:e.title?"title":"",target:"_blank",to:"/".concat(ye.PUBLISHER,"/").concat(e.publisherId,"/").concat(we,"/?").concat(Ae.ARTICLE_ID,"=").concat(e.articleId)},e.children)},et=function(e){function t(e){var a;Object(c.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).limit=5,a.filterArticles=function(e){return a.props.articleList.filter(function(t){return!t.categories.every(function(t){return t._id!==e})})},a.handleScroll=function(){$e(),Math.max(document.body.scrollTop,document.documentElement.scrollTop)+("CSS1Compat"===document.compatMode?document.documentElement.clientHeight:document.body.clientHeight)>Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)-100&&!1===a.state.endOfList&&!1===a.props.loading&&a.fetchNextArticles()},a.fetchNextArticles=function(){var e=5*(a.state.page+1),t=a.state.allArticles.slice(0,e+5);a.setState(Object(O.a)({},a.state,{articlesToRender:t,endOfList:!(t.length<a.state.allArticles.length)})),$e()};var r,n=ze(Ae.CATEGORY_ID);return r=null===n?a.props.articleList:a.filterArticles(n),a.state={page:0,categoryId:n,allArticles:r,articlesToRender:r.slice(0,5),endOfList:!(r.length>5)},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("scroll",this.handleScroll)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll)}},{key:"componentWillReceiveProps",value:function(e){var t,a=ze(Ae.CATEGORY_ID);a!==this.state.categoryId&&(t=null===a?this.props.articleList:this.filterArticles(a),this.setState(Object(O.a)({},this.state,{page:0,categoryId:a,allArticles:t,articlesToRender:t.slice(0,5),endOfList:t.length>5})))}},{key:"render",value:function(){var e=this,t=this.props.match.params.publisherId,a=this.state.articlesToRender.map(function(e){return n.a.createElement(Me.a,{key:e._id,transitionName:"example",transitionAppear:!0,transitionAppearTimeout:1e3,transitionEnterTimeout:1e3,transitionLeaveTimeout:1e3},n.a.createElement("li",{key:e._id,className:"have-img"},n.a.createElement("a",{className:"wrap-img",href:"/",target:"_blank"},n.a.createElement("img",{className:"img-blur-done","data-src":e.imgUrl,"data-has-lazy-src":"false",src:e.imgUrl,alt:"article image url for ".concat(e.title)})),n.a.createElement("div",{className:"content"},n.a.createElement(Qe,{publisherId:t,articleId:e._id,title:!0},e.title),n.a.createElement("p",{className:"abstract"},e.description),n.a.createElement("div",{className:"meta"},n.a.createElement(Qe,{publisherId:t,articleId:e._id},n.a.createElement(pe.a,{type:"eye",theme:"outlined"})," ",e.meta?e.meta.numViews:0)," ",n.a.createElement(Qe,{publisherId:t,articleId:e._id},n.a.createElement(pe.a,{type:"message",theme:"outlined"})," ",e.meta?e.meta.numComments:0)," ",n.a.createElement(Qe,{publisherId:t,articleId:e._id},n.a.createElement(pe.a,{type:"heart",theme:"outlined"})," ",e.meta?e.meta.numLikes:0),n.a.createElement("span",{className:"time"},e.createdOn?Pe(e.createdOn,!0):"")))))}),r=this.props.categoryList.find(function(t){return t._id===e.state.categoryId}),i=r?r.name:"";return n.a.createElement("div",{className:"left"},this.state.categoryId?n.a.createElement("h3",{className:"left-title"},"Articles related to ",i,":"," "):"",n.a.createElement("ul",{className:"note-list",id:"list"},a),this.state.endOfList?n.a.createElement(Ke,null):"")}}]),t}(r.Component),tt=Object(s.c)(function(e){return{articleList:e.articleList.articles,categoryList:e.categoryList.categories,count:e.articleList.count,publisher:e.user.publisher,loading:e.loading.loading}},Je)(et),at=(a(455),function(){var e="\nuniform mat4 uProjection;\nuniform mat4 uModelview;\nuniform vec3 uResolution;\nuniform vec3 uOffset;\nuniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius\nuniform vec3 uFade; //x:start distance, y:half distance, z:near fade start\n\nattribute vec3 aPosition;\nattribute vec3 aEuler;\nattribute vec2 aMisc; //x:size, y:fade\n\nvarying vec3 pposition;\nvarying float psize;\nvarying float palpha;\nvarying float pdist;\n\n//varying mat3 rotMat;\nvarying vec3 normX;\nvarying vec3 normY;\nvarying vec3 normZ;\nvarying vec3 normal;\n\nvarying float diffuse;\nvarying float specular;\nvarying float rstop;\nvarying float distancefade;\n\nvoid main(void) {\n    // Projection is based on vertical angle\n    vec4 pos = uModelview * vec4(aPosition + uOffset, 1.0);\n    gl_Position = uProjection * pos;\n    gl_PointSize = aMisc.x * uProjection[1][1] / -pos.z * uResolution.y * 0.5;\n\n    pposition = pos.xyz;\n    psize = aMisc.x;\n    pdist = length(pos.xyz);\n    palpha = smoothstep(0.0, 1.0, (pdist - 0.1) / uFade.z);\n\n    vec3 elrsn = sin(aEuler);\n    vec3 elrcs = cos(aEuler);\n    mat3 rotx = mat3(\n        1.0, 0.0, 0.0,\n        0.0, elrcs.x, elrsn.x,\n        0.0, -elrsn.x, elrcs.x\n    );\n    mat3 roty = mat3(\n        elrcs.y, 0.0, -elrsn.y,\n        0.0, 1.0, 0.0,\n        elrsn.y, 0.0, elrcs.y\n    );\n    mat3 rotz = mat3(\n        elrcs.z, elrsn.z, 0.0,\n        -elrsn.z, elrcs.z, 0.0,\n        0.0, 0.0, 1.0\n    );\n    mat3 rotmat = rotx * roty * rotz;\n    normal = rotmat[2];\n\n    mat3 trrotm = mat3(\n        rotmat[0][0], rotmat[1][0], rotmat[2][0],\n        rotmat[0][1], rotmat[1][1], rotmat[2][1],\n        rotmat[0][2], rotmat[1][2], rotmat[2][2]\n    );\n    normX = trrotm[0];\n    normY = trrotm[1];\n    normZ = trrotm[2];\n\n    const vec3 lit = vec3(0.6917144638660746, 0.6917144638660746, -0.20751433915982237);\n\n    float tmpdfs = dot(lit, normal);\n    if(tmpdfs < 0.0) {\n        normal = -normal;\n        tmpdfs = dot(lit, normal);\n    }\n    diffuse = 0.4 + tmpdfs;\n\n    vec3 eyev = normalize(-pos.xyz);\n    if(dot(eyev, normal) > 0.0) {\n        vec3 hv = normalize(eyev + lit);\n        specular = pow(max(dot(hv, normal), 0.0), 20.0);\n    }\n    else {\n        specular = 0.0;\n    }\n\n    rstop = clamp((abs(pdist - uDOF.x) - uDOF.y) / uDOF.z, 0.0, 1.0);\n    rstop = pow(rstop, 0.5);\n    //-0.69315 = ln(0.5)\n    distancefade = min(1.0, exp((uFade.x - pdist) * 0.69315 / uFade.y));\n}",t="\n#ifdef GL_ES\n//precision mediump float;\nprecision highp float;\n#endif\n\nuniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius\nuniform vec3 uFade; //x:start distance, y:half distance, z:near fade start\n\nconst vec3 fadeCol = vec3(0.08, 0.03, 0.06);\n\nvarying vec3 pposition;\nvarying float psize;\nvarying float palpha;\nvarying float pdist;\n\n//varying mat3 rotMat;\nvarying vec3 normX;\nvarying vec3 normY;\nvarying vec3 normZ;\nvarying vec3 normal;\n\nvarying float diffuse;\nvarying float specular;\nvarying float rstop;\nvarying float distancefade;\n\nfloat ellipse(vec2 p, vec2 o, vec2 r) {\n    vec2 lp = (p - o) / r;\n    return length(lp) - 1.0;\n}\n\nvoid main(void) {\n    vec3 p = vec3(gl_PointCoord - vec2(0.5, 0.5), 0.0) * 2.0;\n    vec3 d = vec3(0.0, 0.0, -1.0);\n    float nd = normZ.z; //dot(-normZ, d);\n    if(abs(nd) < 0.0001) discard;\n\n    float np = dot(normZ, p);\n    vec3 tp = p + d * np / nd;\n    vec2 coord = vec2(dot(normX, tp), dot(normY, tp));\n\n    //angle = 15 degree\n    const float flwrsn = 0.258819045102521;\n    const float flwrcs = 0.965925826289068;\n    mat2 flwrm = mat2(flwrcs, -flwrsn, flwrsn, flwrcs);\n    vec2 flwrp = vec2(abs(coord.x), coord.y) * flwrm;\n\n    float r;\n    if(flwrp.x < 0.0) {\n        r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.36, 0.96) * 0.5);\n    }\n    else {\n        r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.58, 0.96) * 0.5);\n    }\n\n    if(r > rstop) discard;\n\n    vec3 col = mix(vec3(1.0, 0.8, 0.75), vec3(1.0, 0.9, 0.87), r);\n    float grady = mix(0.0, 1.0, pow(coord.y * 0.5 + 0.5, 0.35));\n    col *= vec3(1.0, grady, grady);\n    col *= mix(0.8, 1.0, pow(abs(coord.x), 0.3));\n    col = col * diffuse + specular;\n\n    col = mix(fadeCol, col, distancefade);\n\n    float alpha = (rstop > 0.001)? (0.5 - r / (rstop * 2.0)) : 1.0;\n    alpha = smoothstep(0.0, 1.0, alpha) * palpha;\n\n    gl_FragColor = vec4(col * 0.5, alpha);\n}",a="\nuniform vec3 uResolution;\nattribute vec2 aPosition;\n\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\n\nvoid main(void) {\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n    texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);\n    screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);\n}",r="\n#ifdef GL_ES\n//precision mediump float;\nprecision highp float;\n#endif\n\nuniform vec2 uTimes;\n\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\n\nvoid main(void) {\n    vec3 col;\n    float c;\n    vec2 tmpv = texCoord * vec2(0.8, 1.0) - vec2(0.95, 1.0);\n    c = exp(-pow(length(tmpv) * 1.8, 2.0));\n    col = mix(vec3(0.02, 0.0, 0.03), vec3(0.96, 0.98, 1.0) * 1.5, c);\n    gl_FragColor = vec4(col * 0.5, 1.0);\n}",n="\n#ifdef GL_ES\n//precision mediump float;\nprecision highp float;\n#endif\nuniform sampler2D uSrc;\nuniform vec2 uDelta;\n\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\n\nvoid main(void) {\n    vec4 col = texture2D(uSrc, texCoord);\n    gl_FragColor = vec4(col.rgb * 2.0 - vec3(0.5), 1.0);\n}",i="\n#ifdef GL_ES\n//precision mediump float;\nprecision highp float;\n#endif\nuniform sampler2D uSrc;\nuniform vec2 uDelta;\nuniform vec4 uBlurDir; //dir(x, y), stride(z, w)\n\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\n\nvoid main(void) {\n    vec4 col = texture2D(uSrc, texCoord);\n    col = col + texture2D(uSrc, texCoord + uBlurDir.xy * uDelta);\n    col = col + texture2D(uSrc, texCoord - uBlurDir.xy * uDelta);\n    col = col + texture2D(uSrc, texCoord + (uBlurDir.xy + uBlurDir.zw) * uDelta);\n    col = col + texture2D(uSrc, texCoord - (uBlurDir.xy + uBlurDir.zw) * uDelta);\n    gl_FragColor = col / 5.0;\n}",o="\nuniform vec3 uResolution;\nattribute vec2 aPosition;\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\nvoid main(void) {\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n    texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);\n    screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);\n}",s="\n#ifdef GL_ES\n//precision mediump float;\nprecision highp float;\n#endif\nuniform sampler2D uSrc;\nuniform sampler2D uBloom;\nuniform vec2 uDelta;\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\nvoid main(void) {\n    vec4 srccol = texture2D(uSrc, texCoord) * 2.0;\n    vec4 bloomcol = texture2D(uBloom, texCoord);\n    vec4 col;\n    col = srccol + bloomcol * (vec4(1.0) + srccol);\n    col *= smoothstep(1.0, 0.0, pow(length((texCoord - vec2(0.5)) * 2.0), 1.2) * 0.5);\n    col = pow(col, vec4(0.45454545454545)); //(1.0 / 2.2)\n\n    gl_FragColor = vec4(col.rgb, 1.0);\n    gl_FragColor.a = 1.0;\n}",c={},l={};c.create=function(e,t,a){return{x:e,y:t,z:a}},c.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},c.cross=function(e,t,a){e.x=t.y*a.z-t.z*a.y,e.y=t.z*a.x-t.x*a.z,e.z=t.x*a.y-t.y*a.x},c.normalize=function(e){var t=e.x*e.x+e.y*e.y+e.z*e.z;t>1e-5&&(t=1/Math.sqrt(t),e.x*=t,e.y*=t,e.z*=t)},c.arrayForm=function(e){return e.array?(e.array[0]=e.x,e.array[1]=e.y,e.array[2]=e.z):e.array=new Float32Array([e.x,e.y,e.z]),e.array},l.createIdentity=function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},l.loadProjection=function(e,t,a,r,n){var i=r*Math.tan(a*Math.PI/180*.5)*2,o=i*t;e[0]=2*r/o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*r/i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=-(n+r)/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=-2*n*r/(n-r),e[15]=0},l.loadLookAt=function(e,t,a,r){var n=c.create(t.x-a.x,t.y-a.y,t.z-a.z);c.normalize(n);var i=c.create(1,0,0);c.cross(i,r,n),c.normalize(i);var o=c.create(1,0,0);c.cross(o,n,i),c.normalize(o),e[0]=i.x,e[1]=o.x,e[2]=n.x,e[3]=0,e[4]=i.y,e[5]=o.y,e[6]=n.y,e[7]=0,e[8]=i.z,e[9]=o.z,e[10]=n.z,e[11]=0,e[12]=-(t.x*e[0]+t.y*e[4]+t.z*e[8]),e[13]=-(t.x*e[1]+t.y*e[5]+t.z*e[9]),e[14]=-(t.x*e[2]+t.y*e[6]+t.z*e[10]),e[15]=1};var u,m={start:0,prev:0,delta:0,elapsed:0},d={width:0,height:0,aspect:1,array:new Float32Array(3),halfWidth:0,halfHeight:0,halfArray:new Float32Array(3)};function f(e,t){var a=u.createShader(e);if(u.shaderSource(a,t),u.compileShader(a),!u.getShaderParameter(a,u.COMPILE_STATUS)){var r=u.getShaderInfoLog(a);return u.deleteShader(a),console.error(r),null}return a}function h(e,t,a,r){var n=f(u.VERTEX_SHADER,e),i=f(u.FRAGMENT_SHADER,t);if(null==n||null==i)return null;var o=u.createProgram();if(u.attachShader(o,n),u.attachShader(o,i),u.deleteShader(n),u.deleteShader(i),u.linkProgram(o),!u.getProgramParameter(o,u.LINK_STATUS)){var s=u.getProgramInfoLog(o);return console.error(s),null}if(a){o.uniforms={};for(var c=0;c<a.length;c++)o.uniforms[a[c]]=u.getUniformLocation(o,a[c])}if(r){o.attributes={};for(var l=0;l<r.length;l++){var m=r[l];o.attributes[m]=u.getAttribLocation(o,m)}}return o}function p(e){for(var t in u.useProgram(e),e.attributes)u.enableVertexAttribArray(e.attributes[t])}function g(e){for(var t in e.attributes)u.disableVertexAttribArray(e.attributes[t]);u.useProgram(null)}d.setSize=function(e,t){d.width=e,d.height=t,d.aspect=d.width/d.height,d.array[0]=d.width,d.array[1]=d.height,d.array[2]=d.aspect,d.halfWidth=Math.floor(e/2),d.halfHeight=Math.floor(t/2),d.halfArray[0]=d.halfWidth,d.halfArray[1]=d.halfHeight,d.halfArray[2]=d.halfWidth/d.halfHeight};var v={angle:60,nearfar:new Float32Array([.1,100]),matrix:l.createIdentity()},y={position:c.create(0,0,100),lookat:c.create(0,0,0),up:c.create(0,1,0),dof:c.create(10,4,8),matrix:l.createIdentity()},E={},b=!1,w=function(){this.velocity=new Array(3),this.rotation=new Array(3),this.position=new Array(3),this.euler=new Array(3),this.size=1,this.alpha=1,this.zkey=0};function x(e,t,a,r){var n={},i=["uResolution","uSrc","uDelta"];a&&(i=i.concat(a));var o=["aPosition"];return r&&(o=o.concat(r)),n.program=h(e,t,i,o),p(n.program),n.dataArray=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n.buffer=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,n.buffer),u.bufferData(u.ARRAY_BUFFER,n.dataArray,u.STATIC_DRAW),u.bindBuffer(u.ARRAY_BUFFER,null),g(n.program),n}function A(e,t){var a=e.program;p(a),u.uniform3fv(a.uniforms.uResolution,d.array),null!=t&&(u.uniform2fv(a.uniforms.uDelta,t.dtxArray),u.uniform1i(a.uniforms.uSrc,0),u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,t.texture))}function R(e){u.bindBuffer(u.ARRAY_BUFFER,e.buffer),u.vertexAttribPointer(e.program.attributes.aPosition,2,u.FLOAT,!1,0,0),u.drawArrays(u.TRIANGLE_STRIP,0,4)}function T(e){g(e.program)}w.prototype.setVelocity=function(e,t,a){this.velocity[0]=e,this.velocity[1]=t,this.velocity[2]=a},w.prototype.setRotation=function(e,t,a){this.rotation[0]=e,this.rotation[1]=t,this.rotation[2]=a},w.prototype.setPosition=function(e,t,a){this.position[0]=e,this.position[1]=t,this.position[2]=a},w.prototype.setEulerAngles=function(e,t,a){this.euler[0]=e,this.euler[1]=t,this.euler[2]=a},w.prototype.setSize=function(e){this.size=e},w.prototype.update=function(e,t){this.position[0]+=this.velocity[0]*e,this.position[1]+=this.velocity[1]*e,this.position[2]+=this.velocity[2]*e,this.euler[0]+=this.rotation[0]*e,this.euler[1]+=this.rotation[1]*e,this.euler[2]+=this.rotation[2]*e};var O={};function S(){!function(){E.area=c.create(20,20,20),E.area.x=E.area.y*d.aspect,E.fader.x=10,E.fader.y=E.area.z,E.fader.z=.1;for(var e=2*Math.PI,t=c.create(0,0,0),a=0,r=function(){return 2*Math.random()-1},n=0;n<E.numFlowers;n++){var i=E.particles[n];t.x=.3*r()+.8,t.y=.2*r()-1,t.z=.3*r()+.5,c.normalize(t),a=2+1*Math.random(),i.setVelocity(t.x*a,t.y*a,t.z*a),i.setRotation(r()*e*.5,r()*e*.5,r()*e*.5),i.setPosition(r()*E.area.x,r()*E.area.y,r()*E.area.z),i.setEulerAngles(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),i.setSize(.9+.1*Math.random())}}(),y.position.z=E.area.z+v.nearfar[0],v.angle=180*Math.atan2(E.area.y,y.position.z+E.area.z)/Math.PI*2,l.loadProjection(v.matrix,d.aspect,v.angle,v.nearfar[0],v.nearfar[1])}function L(){l.loadLookAt(y.matrix,y.position,y.lookat,y.up),u.enable(u.DEPTH_TEST),u.bindFramebuffer(u.FRAMEBUFFER,d.mainRT.frameBuffer),u.viewport(0,0,d.mainRT.width,d.mainRT.height),u.clearColor(.005,0,.05,0),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT),u.disable(u.DEPTH_TEST),A(O.sceneBg,null),u.uniform2f(O.sceneBg.program.uniforms.uTimes,m.elapsed,m.delta),R(O.sceneBg),T(O.sceneBg),u.enable(u.DEPTH_TEST),function(){for(var e=2*Math.PI,t=function(e,t,a){Math.abs(e.position[t])-.5*e.size>a&&(e.position[t]>0?e.position[t]-=2*a:e.position[t]+=2*a)},a=function(t,a){t.euler[a]=t.euler[a]%e,t.euler[a]<0&&(t.euler[a]+=e)},r=0;r<E.numFlowers;r++){var n=E.particles[r];n.update(m.delta,m.elapsed),t(n,0,E.area.x),t(n,1,E.area.y),t(n,2,E.area.z),a(n,0),a(n,1),a(n,2),n.alpha=1,n.zkey=y.matrix[2]*n.position[0]+y.matrix[6]*n.position[1]+y.matrix[10]*n.position[2]+y.matrix[14]}E.particles.sort(function(e,t){return e.zkey-t.zkey});for(var i=E.positionArrayOffset,o=E.eulerArrayOffset,s=E.miscArrayOffset,l=0;l<E.numFlowers;l++){var f=E.particles[l];E.dataArray[i]=f.position[0],E.dataArray[i+1]=f.position[1],E.dataArray[i+2]=f.position[2],i+=3,E.dataArray[o]=f.euler[0],E.dataArray[o+1]=f.euler[1],E.dataArray[o+2]=f.euler[2],o+=3,E.dataArray[s]=f.size,E.dataArray[s+1]=f.alpha,s+=2}u.enable(u.BLEND),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA);var h=E.program;p(h),u.uniformMatrix4fv(h.uniforms.uProjection,!1,v.matrix),u.uniformMatrix4fv(h.uniforms.uModelview,!1,y.matrix),u.uniform3fv(h.uniforms.uResolution,d.array),u.uniform3fv(h.uniforms.uDOF,c.arrayForm(y.dof)),u.uniform3fv(h.uniforms.uFade,c.arrayForm(E.fader)),u.bindBuffer(u.ARRAY_BUFFER,E.buffer),u.bufferData(u.ARRAY_BUFFER,E.dataArray,u.DYNAMIC_DRAW),u.vertexAttribPointer(h.attributes.aPosition,3,u.FLOAT,!1,0,E.positionArrayOffset*Float32Array.BYTES_PER_ELEMENT),u.vertexAttribPointer(h.attributes.aEuler,3,u.FLOAT,!1,0,E.eulerArrayOffset*Float32Array.BYTES_PER_ELEMENT),u.vertexAttribPointer(h.attributes.aMisc,2,u.FLOAT,!1,0,E.miscArrayOffset*Float32Array.BYTES_PER_ELEMENT);for(var b=1;b<2;b++){var w=-2*b;E.offset[0]=-1*E.area.x,E.offset[1]=-1*E.area.y,E.offset[2]=E.area.z*w,u.uniform3fv(h.uniforms.uOffset,E.offset),u.drawArrays(u.POINT,0,E.numFlowers),E.offset[0]=-1*E.area.x,E.offset[1]=1*E.area.y,E.offset[2]=E.area.z*w,u.uniform3fv(h.uniforms.uOffset,E.offset),u.drawArrays(u.POINT,0,E.numFlowers),E.offset[0]=1*E.area.x,E.offset[1]=-1*E.area.y,E.offset[2]=E.area.z*w,u.uniform3fv(h.uniforms.uOffset,E.offset),u.drawArrays(u.POINT,0,E.numFlowers),E.offset[0]=1*E.area.x,E.offset[1]=1*E.area.y,E.offset[2]=E.area.z*w,u.uniform3fv(h.uniforms.uOffset,E.offset),u.drawArrays(u.POINT,0,E.numFlowers)}E.offset[0]=0,E.offset[1]=0,E.offset[2]=0,u.uniform3fv(h.uniforms.uOffset,E.offset),u.drawArrays(u.POINT,0,E.numFlowers),u.bindBuffer(u.ARRAY_BUFFER,null),g(h),u.enable(u.DEPTH_TEST),u.disable(u.BLEND)}(),function(){u.enable(u.TEXTURE_2D),u.disable(u.DEPTH_TEST);var e=function(e,t){u.bindFramebuffer(u.FRAMEBUFFER,e.frameBuffer),u.viewport(0,0,e.width,e.height),t&&(u.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT))};e(d.wHalfRT0,!0),A(O.mkBrightBuf,d.mainRT),R(O.mkBrightBuf),T(O.mkBrightBuf);for(var t=0;t<2;t++){var a=1.5+1*t,r=2+1*t;e(d.wHalfRT1,!0),A(O.dirBlur,d.wHalfRT0),u.uniform4f(O.dirBlur.program.uniforms.uBlurDir,a,0,r,0),R(O.dirBlur),T(O.dirBlur),e(d.wHalfRT0,!0),A(O.dirBlur,d.wHalfRT1),u.uniform4f(O.dirBlur.program.uniforms.uBlurDir,0,a,0,r),R(O.dirBlur),T(O.dirBlur)}u.bindFramebuffer(u.FRAMEBUFFER,null),u.viewport(0,0,d.width,d.height),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT),A(O.finalComp,d.mainRT),u.uniform1i(O.finalComp.program.uniforms.uBloom,1),u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,d.wHalfRT0.texture),R(O.finalComp),T(O.finalComp),u.enable(u.DEPTH_TEST)}()}function C(){d.setSize(u.canvas.width,u.canvas.height),u.clearColor(.2,.2,.5,1),u.viewport(0,0,d.width,d.height);var e=function(e,t,a){var r=d[e];r&&function(e){u.deleteFramebuffer(e.frameBuffer),u.deleteRenderbuffer(e.renderBuffer),u.deleteTexture(e.texture)}(r),d[e]=function(e,t){var a={width:e,height:t,sizeArray:new Float32Array([e,t,e/t]),dtxArray:new Float32Array([1/e,1/t])};return a.frameBuffer=u.createFramebuffer(),a.renderBuffer=u.createRenderbuffer(),a.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,a.texture),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,e,t,0,u.RGBA,u.UNSIGNED_BYTE,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.bindFramebuffer(u.FRAMEBUFFER,a.frameBuffer),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,a.texture,0),u.bindRenderbuffer(u.RENDERBUFFER,a.renderBuffer),u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_COMPONENT16,e,t),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,a.renderBuffer),u.bindTexture(u.TEXTURE_2D,null),u.bindRenderbuffer(u.RENDERBUFFER,null),u.bindFramebuffer(u.FRAMEBUFFER,null),a}(t,a)};e("mainRT",d.width,d.height),e("wFullRT0",d.width,d.height),e("wFullRT1",d.width,d.height),e("wHalfRT0",d.halfWidth,d.halfHeight),e("wHalfRT1",d.halfWidth,d.halfHeight)}var P=!0;function _(e){var t=document.body,a=document.documentElement,r=Math.max(t.clientWidth,t.scrollWidth,a.scrollWidth,a.clientWidth),n=Math.max(t.clientHeight,t.scrollHeight,a.scrollHeight,a.clientHeight);e.width=r,e.height=n}var F,B,D=document.getElementById("sakura");try{_(D),u=D.getContext("experimental-webgl")}catch(N){return alert("WebGL not supported."+N),void console.error(N)}window.addEventListener("resize",function(e){_(document.getElementById("sakura")),C(),b&&S()}),C(),function(){var e,t,c=a;t=r,O.sceneBg=x(c,t,["uTimes"],null),t=n,O.mkBrightBuf=x(c,t,null,null),t=i,O.dirBlur=x(c,t,["uBlurDir"],null),e=o,t=s,O.finalComp=x(e,t,["uBloom"],null)}(),function(){var a=u.getParameter(u.ALIASED_POINT_SIZE_RANGE);d.pointSize={min:a[0],max:a[1]};var r=e,n=t;E.program=h(r,n,["uProjection","uModelview","uResolution","uOffset","uDOF","uFade"],["aPosition","aEuler","aMisc"]),p(E.program),E.offset=new Float32Array([0,0,0]),E.fader=c.create(0,10,0),E.numFlowers=1600,E.particles=new Array(E.numFlowers),E.dataArray=new Float32Array(8*E.numFlowers),E.positionArrayOffset=0,E.eulerArrayOffset=3*E.numFlowers,E.miscArrayOffset=6*E.numFlowers,E.buffer=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,E.buffer),u.bufferData(u.ARRAY_BUFFER,E.dataArray,u.DYNAMIC_DRAW),u.bindBuffer(u.ARRAY_BUFFER,null),g(E.program);for(var i=0;i<E.numFlowers;i++)E.particles[i]=new w}(),b=!0,S(),m.start=new Date,m.prev=m.start,function e(){var t=new Date;m.elapsed=(t-m.start)/1e3,m.delta=(t-m.prev)/1e3,m.prev=t,P&&requestAnimationFrame(e),L()}(),(F=window)["r"+(B="equestAnimationFrame")]=F["r"+B]||F["webkitR"+B]||F["mozR"+B]||F["msR"+B]||F["oR"+B]||function(e){F.setTimeout(e,1e3/60)}}),rt={savePublisher:$},nt=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){at()}},{key:"render",value:function(){var e=this.props.match.url;"/"===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1));var t=e.length-Ee.length;return e.substring(t,e.length)===Ee&&(e=e.substring(0,t-1)),n.a.createElement("div",{className:"home"}," ",n.a.createElement("canvas",{id:"sakura"}),n.a.createElement("div",{className:"content"},n.a.createElement("div",{className:"home-header"},n.a.createElement(Ve.a,{className:"link",to:"".concat(e,"/").concat(Ee)},n.a.createElement("img",{className:"avatar",src:this.props.publisher.avatar}))),n.a.createElement("div",{className:"home-body"},n.a.createElement("div",{className:"list"},n.a.createElement(Ve.a,{className:"link",to:"".concat(e,"/").concat(be)},n.a.createElement(ge.a,{icon:"read",type:"primary"},"\u6587\u7ae0")),n.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",className:"link",href:"https://github.com/chuntonggao"},n.a.createElement(ge.a,{icon:"github",type:"primary"},"GitHub"))),n.a.createElement("div",{className:"introduce"}," ",this.props.publisher.bio," "))))}}]),t}(r.Component),it=Object(s.c)(function(e){return{publisher:e.user.publisher}},rt)(nt),ot=(a(457),a(459),a(483)),st=a(491),ct=(a(56),a(487)),lt=a(492),ut=a(493),mt=[{displayName:"Home",icon:"home",to:Ee},{displayName:"Articles",icon:"ordered-list",to:be},{displayName:"About",icon:"user",to:xe}],dt=function(e){return n.a.createElement(Ve.a,{to:"/publisher/".concat(e.publisher._id)},n.a.createElement("div",{className:"logo"},n.a.createElement("img",{src:e.publisher.avatar,alt:"nav-avatar"})))},ft=ot.a.Header,ht=ct.a.SubMenu,pt=ct.a.ItemGroup,gt=function(e){var t=mt.map(function(t){return n.a.createElement(ct.a.Item,{key:t.to},n.a.createElement(Ve.a,{to:"/".concat(ye.PUBLISHER,"/").concat(e.publisher._id,"/").concat(t.to),onClick:function(){return e.updateActivePage(t.to)}},n.a.createElement(pe.a,{type:t.icon,theme:"outlined"}),t.displayName))});return n.a.createElement(ft,{className:"header",style:{position:"fixed",zIndex:1,top:0,width:"100%",minWidth:"1200px",height:"66px",float:"left",backgroundColor:"white",borderBottom:"1px solid #eee"}},n.a.createElement(lt.a,{className:"container"},n.a.createElement(ut.a,{style:{width:"120px",float:"left"}},n.a.createElement(dt,{publisher:e.publisher})),n.a.createElement(ut.a,{style:{width:"780px",float:"left"}},n.a.createElement(ct.a,{theme:"light",mode:"horizontal",defaultSelectedKeys:["1"],selectedKeys:[e.activePage],style:{lineHeight:"64px",borderBottom:"none"}},t)),n.a.createElement(ut.a,{style:{textAlign:"right",width:"300px",float:"left"}},e.reader?n.a.createElement(ct.a,{style:{width:220,lineHeight:"64px",display:"inline-block"},mode:"horizontal"},n.a.createElement(ht,{title:n.a.createElement("span",{className:"submenu-title-wrapper"},n.a.createElement(he.a,{size:"large",icon:"user",src:e.reader.avatar,style:{marginRight:5}}),e.reader.name)},n.a.createElement(pt,null,n.a.createElement(ct.a.Item,{onClick:function(){return V.dispatch(Z())},key:"logout"},"Log out")))):n.a.createElement("div",null,n.a.createElement(ge.a,{type:"primary",icon:"login",style:{marginRight:"15px"},onClick:function(){return e.setShowLogin(!0)}},"Log in"),n.a.createElement(ge.a,{type:"primary",icon:"user",style:{marginRight:"15px"},onClick:function(){return e.setShowRegister(!0)}},"Register")))))},vt=a(484),yt=a(489),Et={saveReader:K},bt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(n)))).state={email:"",password:"",loading:!1},a.login=Object(w.a)(b.a.mark(function e(){var t,r,n;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({loading:!0}),e.next=3,se(a.state);case 3:t=e.sent,a.setState({loading:!1}),t.data&&(r=t.data,n=r.user,a.props.saveReader(n),a.props.setShowLogin(!1),vt.a.success("Login successful."));case 6:case"end":return e.stop()}},e)})),a.handleSubmit=function(){var e=new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$");a.state.email?e.test(a.state.email)?a.state.password?a.login():vt.a.error("Please enter your password."):vt.a.error("Invalid email."):vt.a.error("Please enter your email.")},a.handleChange=function(e){var t=e.target.name,r=Object(O.a)({},a.state);r[t]=e.target.value,a.setState(r)},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement(yt.a,{title:"Login",style:{top:"25%"},visible:!0,onCancel:function(){return e.props.setShowLogin(!1)},width:400,footer:null},n.a.createElement("div",{className:"login-input"},n.a.createElement(He.a,{style:{marginBottom:20},prefix:n.a.createElement(pe.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),name:"email",placeholder:"Email",value:this.state.email,onChange:this.handleChange}),n.a.createElement(He.a,{style:{marginBottom:40},prefix:n.a.createElement(pe.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",name:"password",placeholder:"Password",value:this.state.password,onChange:this.handleChange})),n.a.createElement("div",{className:"login-submit"},n.a.createElement(ge.a,{style:{width:"100%",marginBottom:"20px"},type:"primary",onClick:this.handleSubmit,loading:this.state.loading},"Login")))}}]),t}(r.Component),wt=Object(s.c)(function(e){return{reader:e.user.reader}},Et)(bt),xt=a(490),At=function(e){var t,a=mt.map(function(t){return n.a.createElement("p",{key:t.to,onClick:function(){return e.updateActivePage(t.to)}},n.a.createElement(Ve.a,{to:"/".concat(ye.PUBLISHER,"/").concat(e.publisher._id,"/").concat(t.to)},n.a.createElement(pe.a,{type:t.icon})," ".concat(t.displayName)))});return t=e.reader?n.a.createElement("div",{onClick:function(){V.dispatch(Z()),e.setShowDrawer(!1)}},n.a.createElement("p",null,e.reader.name),n.a.createElement("p",null,n.a.createElement(pe.a,{type:"logout"})," Logout")):n.a.createElement("div",null,n.a.createElement("p",{onClick:function(){e.setShowLogin(!0),e.setShowDrawer(!1)}},n.a.createElement(pe.a,{type:"login"})," Login"),n.a.createElement("p",{onClick:function(){e.setShowRegister(!0),e.setShowDrawer(!1)}},n.a.createElement(pe.a,{type:"user"})," Register")),n.a.createElement(xt.a,{placement:"top",closable:!1,onClose:function(){return e.setShowDrawer(!1)},visible:!0,height:420},n.a.createElement("div",{className:"drawer"},a," ",t))},Rt=ot.a.Header,Tt=function(e){var t="";return e.activePage===be?t="Articles":e.activePage===xe&&(t="About"),n.a.createElement(Rt,{className:"header",style:{position:"fixed",zIndex:1,top:0,width:"100%",height:"64px",float:"left",backgroundColor:"white",borderBottom:"1px solid #eee"}},n.a.createElement(lt.a,{className:"container"},n.a.createElement(ut.a,{style:{width:"25%",float:"left",lineHeight:"64px"}},n.a.createElement(dt,{publisher:e.publisher})),n.a.createElement(ut.a,{style:{textAlign:"center",width:"50%",float:"left"}},n.a.createElement("div",{className:"nav-title"}," ",t," ")),n.a.createElement(ut.a,{style:{textAlign:"right",width:"25%",float:"left"}},n.a.createElement("div",null,n.a.createElement(pe.a,{type:"bars",onClick:function(){return e.setShowDrawer(!0)},style:{fontSize:"40px",marginRight:"10px",marginTop:"10px"}})))))},Ot={saveReader:K},St=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(n)))).state={email:"",password:"",confirmPassword:"",name:"",phone:"",loading:!1},a.register=Object(w.a)(b.a.mark(function e(){var t,r,n;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({loading:!0}),e.next=3,ce(a.state);case 3:t=e.sent,a.setState({loading:!1}),t.data&&(r=t.data,n=r.user,a.props.saveReader(n),a.props.setShowRegister(!1),vt.a.success("Registration successful."));case 6:case"end":return e.stop()}},e)})),a.handleSubmit=function(){var e=new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$");a.state.email?e.test(a.state.email)?a.state.name?a.state.password?a.state.confirmPassword?a.state.password!==a.state.confirmPassword?vt.a.error("Your passwords don't match."):a.state.phone&&!/^\d+$/.test(a.state.phone)?vt.a.error("Invalid phone number."):a.register():vt.a.error("Please confirm your password."):vt.a.error("Please enter your password."):vt.a.error("Please enter your name."):vt.a.error("Invalid email."):vt.a.error("Please enter your email.")},a.handleChange=function(e){var t=e.target.name,r=Object(O.a)({},a.state);r[t]=e.target.value,a.setState(r)},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement(yt.a,{title:"Register",style:{top:"18%"},visible:!0,onCancel:function(){return e.props.setShowRegister(!1)},width:500,footer:null},n.a.createElement("div",{className:"register-input"},n.a.createElement(He.a,{style:{marginBottom:20},prefix:n.a.createElement(pe.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),name:"email",placeholder:"Email",value:this.state.email,onChange:this.handleChange}),n.a.createElement(He.a,{style:{marginBottom:20},prefix:n.a.createElement(pe.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",name:"password",placeholder:"Password",value:this.state.password,onChange:this.handleChange}),n.a.createElement(He.a,{style:{marginBottom:20},prefix:n.a.createElement(pe.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",name:"confirmPassword",placeholder:"Confirm password",value:this.state.confirmPassword,onChange:this.handleChange}),n.a.createElement(He.a,{style:{marginBottom:20},prefix:n.a.createElement(pe.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),name:"name",placeholder:"Name",value:this.state.name,onChange:this.handleChange}),n.a.createElement(He.a,{style:{marginBottom:20},prefix:n.a.createElement(pe.a,{type:"phone",style:{color:"rgba(0,0,0,.25)"}}),name:"phone",placeholder:"Phone",value:this.state.phone,onChange:this.handleChange})),n.a.createElement("div",{className:"register-submit"},n.a.createElement(ge.a,{style:{width:"100%",marginBottom:"20px"},type:"primary",onClick:this.handleSubmit,loading:this.state.loading},"Register")))}}]),t}(r.Component),Lt=Object(s.c)(function(e){return{reader:e.user.reader}},Ot)(St),Ct=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(n)))).state={showLogin:!1,showRegister:!1,activePage:a.props.match.params.page,showDrawer:!1},a.setShowDrawer=function(e){return a.setState({showDrawer:e})},a.setShowLogin=function(e){return a.setState({showLogin:e})},a.setShowRegister=function(e){return a.setState({showRegister:e})},a.updateActivePage=function(e){a.setState(Object(O.a)({},a.state,{activePage:e,showDrawer:!1}))},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e;return e=!0===this.props.isMobile?n.a.createElement(Tt,{activePage:this.state.activePage,publisher:this.props.publisher,setShowDrawer:this.setShowDrawer}):n.a.createElement(gt,{publisher:this.props.publisher,reader:this.props.reader,setShowLogin:this.setShowLogin,setShowRegister:this.setShowRegister,activePage:this.state.activePage,updateActivePage:this.updateActivePage}),n.a.createElement("div",{className:"left"},e,this.state.showDrawer&&n.a.createElement(At,{publisher:this.props.publisher,reader:this.props.reader,setShowDrawer:this.setShowDrawer,setShowLogin:this.setShowLogin,setShowRegister:this.setShowRegister,updateActivePage:this.updateActivePage}),this.state.showLogin&&n.a.createElement(wt,{setShowLogin:this.setShowLogin}),this.state.showRegister&&n.a.createElement(Lt,{setShowRegister:this.setShowRegister}))}}]),t}(r.Component),Pt=Object(s.c)(function(e){return{publisher:e.user.publisher,reader:e.user.reader,isMobile:e.isMobile.isMobile}})(Ct),_t=(a(475),Object(s.c)(function(e){return{categoryList:e.categoryList.categories,publisher:e.user.publisher}})(function(e){var t=e.match.params.publisherId,a=e.categoryList.map(function(e){return n.a.createElement(Ve.a,{className:"item",key:e._id,to:"/".concat(ye.PUBLISHER,"/").concat(t,"/").concat(be,"?").concat(Ae.CATEGORY_ID,"=").concat(e._id)},n.a.createElement("span",null,e.name))});return n.a.createElement("div",{className:"right"},n.a.createElement(he.a,{className:"right-logo",src:e.publisher.avatar,size:130,icon:"user"}),n.a.createElement("div",{className:"title"},e.publisher.name),n.a.createElement("div",{className:"right-content"}),n.a.createElement("div",{className:"tags"},n.a.createElement("div",{className:"title"},"Categories"),a))})),Ft=ot.a.Content,Bt=ot.a.Footer,Dt=ot.a.Sider,Nt=Object(s.c)(function(e){return{isMobile:e.isMobile.isMobile}})(function(e){var t=!1,a=e.match.params.page;a===we||a===xe||e.isMobile||(t=!0);var r={history:e.history,location:e.location,match:e.match};return n.a.createElement("div",{className:"Layouts"},n.a.createElement("div",null,n.a.createElement(Pt,r),n.a.createElement(ot.a,{className:"layout"},n.a.createElement(Ft,null,n.a.createElement(ot.a,{style:{padding:"24px 0",background:"#fff"}},n.a.createElement(Ft,{style:{padding:"0 24px 0 0",minHeight:280}},e.children),t&&n.a.createElement(Dt,{width:350,style:{background:"#fff"}},n.a.createElement(_t,r))))),n.a.createElement(Bt,{style:{textAlign:"center",background:"#fff"}},"Bloggy \xa92020 Created by Chuntong, Bolin, Max and Kerry"),n.a.createElement(st.a,null)))}),kt=function(e){return ne("".concat("https://bloggy-service.herokuapp.com","/getCategoryList"),{method:"POST",data:e})},zt={saveArticleList:Ze,saveCategoryList:function(e){return{type:P,payload:{categories:e}}},savePublisher:$},It=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(n)))).state={ready:!1},a.initPublisher=Object(w.a)(b.a.mark(function e(){var t,r,n,i;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.match.params.publisherId,e.next=3,oe({_id:t});case 3:(r=e.sent).data&&(n=r.data,i=n.user,a.props.savePublisher(i));case 5:case"end":return e.stop()}},e)})),a.initCategoryList=Object(w.a)(b.a.mark(function e(){var t,r,n,i;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.match.params.publisherId,e.next=3,kt({user:t});case 3:(r=e.sent).data&&(n=r.data,i=n.categoryList,a.props.saveCategoryList(i));case 5:case"end":return e.stop()}},e)})),a.initArticleList=Object(w.a)(b.a.mark(function e(){var t,r,n,i,o;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.match.params.publisherId,e.next=3,Te({user:t});case 3:(r=e.sent).data&&(n=r.data,i=n.articleList,o=n.count,a.props.saveArticleList({articles:i,count:o}));case 5:case"end":return e.stop()}},e)})),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){void 0===this.props.publisher?this.initPublisher():void 0===this.props.categoryList?this.initCategoryList():void 0===this.props.articleList?this.initArticleList():this.setState({ready:!0})}},{key:"render",value:function(){if(this.state.ready){var e=this.props.match.params.page,t=this.props.publisher?this.props.publisher.name:"";return e===be?t+=" - Articles":e===xe&&(t+=" - About"),n.a.createElement(n.a.Fragment,null,n.a.createElement(ve.a,null,n.a.createElement("title",null,t)),this.props.children)}return n.a.createElement(n.a.Fragment,null,n.a.createElement(ve.a,null,n.a.createElement("title",null,"Bloggy Reader")),n.a.createElement("span",null),";")}}]),t}(r.Component),jt=Object(s.c)(function(e){return{articleList:e.articleList.articles,categoryList:e.categoryList.categories,publisher:e.user.publisher}},zt)(It),Mt=[{path:"/".concat(ye.PUBLISHER,"/:").concat(ye.PUBLISHER_ID),exact:!0,render:function(e){return n.a.createElement(jt,e,n.a.createElement(it,e))}},{path:"/".concat(ye.PUBLISHER,"/:").concat(ye.PUBLISHER_ID,"/:").concat(ye.PAGE),exact:!0,render:function(e){switch(e.match.params.page){case Ee:return n.a.createElement(jt,e,n.a.createElement(it,e));case be:return n.a.createElement(jt,e,n.a.createElement(Nt,e,n.a.createElement(tt,e)));case we:return n.a.createElement(jt,e,n.a.createElement(Nt,e,n.a.createElement(qe,e)));case xe:return n.a.createElement(jt,e,n.a.createElement(Nt,e,n.a.createElement(qe,Object.assign({isAboutPage:!0},e))));default:return n.a.createElement(jt,e,n.a.createElement(it,e))}}}],Ut=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(n)))).resetIsMobile=function(){return V.dispatch(fe(B()))},a.resize=function(){return Object(y.a)(500,a.resetIsMobile)()},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize)}},{key:"render",value:function(){return console.log("cookies: "),console.log(p.a.get()),n.a.createElement(f.a,{history:this.props.history},n.a.createElement(ue,null,n.a.createElement(de,null,n.a.createElement(g.a,null,Mt.map(function(e,t){return n.a.createElement(v.a,{render:e.render,exact:e.exact,key:t,path:e.path})})))))}}]),t}(r.Component),Ht=Object(s.c)(function(e){return{loading:e.loading.loading,router:e.router}})(Ut);o.a.render(n.a.createElement(s.a,{store:V},n.a.createElement(Ht,{history:X})),document.getElementById("root"))},56:function(e,t,a){}},[[156,2,1]]]);
//# sourceMappingURL=main.956e5eb3.chunk.js.map